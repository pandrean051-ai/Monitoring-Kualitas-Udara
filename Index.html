<!DOCTYPE html><html lang="en"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>IAQ Monitoring Dashboard</title>    <!-- Memuat Tailwind CSS dari CDN -->    <script src="https://cdn.tailwindcss.com"></script>    <!-- Memuat Firebase SDKs (v8 untuk Realtime Database) -->    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>    <!-- Memuat Chart.js untuk Grafik -->    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>    <style>        /* Menggunakan font Inter */        :root { font-family: 'Inter', sans-serif; }    </style>    <script>        // ==========================================        // 1. FIREBASE CONFIGURATION (WAJIB DIGANTI)        // ==========================================        let firebaseConfig = {            // Placeholder: GANTI dengan FIREBASE CONFIG Anda dari kode ESP32            apiKey: "AIzaSyAD1QPvINjWitgo_Rrj44s47Pr4S1BU_lM",            databaseURL: "https://monitoring-kualitas-udar-8ad9d-default-rtdb.asia-southeast1.firebasedatabase.app",            projectId: "monitoring-kualitas-udar-8ad9d",        };        // Menggunakan konfigurasi lingkungan Canvas jika tersedia        if (typeof __firebase_config !== 'undefined') {            try {                // Konfigurasi dari lingkungan Canvas biasanya untuk Firestore,                 // tapi kita tetap gunakan jika ada                const envConfig = JSON.parse(__firebase_config);                firebaseConfig = { ...firebaseConfig, ...envConfig };            } catch (e) {                console.error("Gagal memparsing __firebase_config:", e);            }        }        // ==========================================        // 2. GLOBAL VARIABLES        // ==========================================        const SENSORS = ['suhu', 'kelembaban', 'debu', 'co2'];        const SENSOR_LABELS = {            suhu: { label: 'Temperature (°C)', unit: ' °C', color: 'rgb(255, 99, 132)' },            kelembaban: { label: 'Humidity (%)', unit: ' %', color: 'rgb(54, 162, 235)' },            debu: { label: 'Dust (mg/m³)', unit: ' mg/m³', color: 'rgb(255, 205, 86)' },            co2: { label: 'CO2 (ppm)', unit: ' ppm', color: 'rgb(75, 192, 192)' }        };        let app;        let db;        // ==========================================        // 3. UTILITY FUNCTIONS        // ==========================================        /**         * Mendapatkan waktu saat ini dalam format lokal (WIB/WITA/WIT).         */        function getCurrentFormattedTime() {            return new Date().toLocaleString('id-ID', {                year: 'numeric',                month: 'long',                day: 'numeric',                hour: '2-digit',                minute: '2-digit',                second: '2-digit',                timeZoneName: 'short'            });        }                function getStatusColor(status) {            switch (status) {                case 'Bersih': return 'bg-green-600'; // Warna untuk mode gelap                case 'Normal': return 'bg-yellow-600';                case 'Buruk': return 'bg-red-600';                default: return 'bg-gray-600';            }        }        function createChart(id, type, label, data, color) {            const ctx = document.getElementById(id).getContext('2d');            // Menyesuaikan warna teks dan garis pada grafik untuk tema gelap            Chart.defaults.color = '#e5e7eb'; // Warna teks default (abu-abu terang)            Chart.defaults.borderColor = 'rgba(107, 114, 128, 0.5)'; // Warna garis grid                        new Chart(ctx, {                type: type,                data: {                    labels: data.labels,                    datasets: [{                        label: label,                        data: data.values,                        borderColor: color,                        backgroundColor: color.replace('rgb', 'rgba').replace(')', ', 0.6)'), // Opasitas untuk bar                        fill: type === 'line', // Hanya mengisi area di bawah garis untuk grafik garis                        tension: 0.2                    }]                },                options: {                    responsive: true,                    maintainAspectRatio: false,                    scales: {                        y: {                             beginAtZero: true,                            grid: { color: 'rgba(107, 114, 128, 0.3)' }                         },                        x: {                            grid: { color: 'rgba(107, 114, 128, 0.3)' }                        }                    },                    plugins: { legend: { display: false } }                }            });        }        // ==========================================        // 4. DATA FETCHING & RENDERING        // ==========================================                // --- FETCH REALTIME STATUS ---        function listenForCurrentStatus() {            // Mendengarkan perubahan pada path /IAQ/            db.ref('/IAQ').on('value', (snapshot) => {                const data = snapshot.val();                if (data) {                    // *** Mengambil waktu real-time saat snapshot diterima ***                    const realtimeTimestamp = getCurrentFormattedTime();                                        // Update header status                    const statusDiv = document.getElementById('iaq-status');                    const color = getStatusColor(data.status);                    statusDiv.className = `p-4 text-white font-bold rounded-xl shadow-xl text-center mb-4 ${color}`;                    statusDiv.innerHTML = `                        <p class="text-2xl">${data.status.toUpperCase()}</p>                        <p class="text-sm mt-1">Kualitas Udara Terkini</p>                    `;                    // Update timestamp display                    const timeDiv = document.getElementById('last-updated-time');                    timeDiv.innerHTML = `<p class="text-sm text-gray-400 text-center mt-2">Data terakhir diperbarui pada: <strong class="text-gray-100">${realtimeTimestamp}</strong></p>`;                                        // Update sensor cards                    let cardsHtml = '';                    SENSORS.forEach(key => {                        const info = SENSOR_LABELS[key];                        const value = data[key] ? data[key].toFixed(key === 'debu' ? 3 : 1) : 'N/A';                                                // Menentukan warna nilai untuk kontras yang menyala                        const valueColor = key === 'suhu' ? 'text-red-400' :                                            key === 'kelembaban' ? 'text-blue-400' :                                           key === 'debu' ? 'text-yellow-400' : 'text-green-400';                        cardsHtml += `                            <div class="bg-gray-800 p-6 rounded-xl shadow-lg text-center border border-gray-700">                                <p class="text-xs font-semibold uppercase text-gray-400">${info.label.split('(')[0].trim()}</p>                                <p class="text-4xl font-extrabold mt-2 ${valueColor}">${value}</p>                                <p class="text-sm text-gray-500">${info.unit.trim()}</p>                            </div>                        `;                    });                    document.getElementById('sensor-cards').innerHTML = cardsHtml;                }            }, (error) => {                console.error("Error reading IAQ data:", error);                document.getElementById('iaq-status').textContent = "Status: Gagal memuat data.";            });        }                // --- FETCH AND RENDER LOGS (TRENDS) ---        async function fetchAndRenderTrends() {                        document.getElementById('loading-message').classList.remove('hidden');            // ===================================            // 1. HOURLY TRENDS (Tren Per Jam - 24 Jam Terakhir)            // ===================================            const hourlyLabels = Array.from({ length: 24 }, (_, i) => `${String(i).padStart(2, '0')}:00`);            // Data Simulasi            const simulatedHourlyData = {                suhu: { values: Array.from({ length: 24 }, () => (Math.random() * 5 + 20).toFixed(1)) },                kelembaban: { values: Array.from({ length: 24 }, () => (Math.random() * 10 + 70).toFixed(1)) },                debu: { values: Array.from({ length: 24 }, () => (Math.random() * 0.1 + 0.05).toFixed(3)) },                co2: { values: Array.from({ length: 24 }, () => (Math.random() * 500 + 800).toFixed(0)) }            };                        document.getElementById('hourly-trends-container').innerHTML = SENSORS.map(key => `                <div class="lg:w-1/2 w-full p-4">                    <div class="bg-gray-800 rounded-xl shadow-lg p-4 h-96 border border-gray-700">                        <h3 class="text-lg font-bold text-gray-200 mb-4">${SENSOR_LABELS[key].label} - Tren Per Jam</h3>                        <canvas id="${key}-hourly-chart"></canvas>                    </div>                </div>            `).join('');            SENSORS.forEach(key => {                createChart(                    `${key}-hourly-chart`,                     'line',                     SENSOR_LABELS[key].label,                     { labels: hourlyLabels, values: simulatedHourlyData[key].values },                    SENSOR_LABELS[key].color                );            });            // ===================================            // 2. DAILY TRENDS (Tren Harian - 7 Hari Terakhir)            // ===================================            const today = new Date();            const dailyLabels = [];            for (let i = 6; i >= 0; i--) {                const d = new Date(today);                d.setDate(today.getDate() - i);                dailyLabels.push(d.toLocaleDateString('id-ID', { day: 'numeric', month: 'short' }));            }                        // Data Simulasi            const simulatedDailyData = {                suhu: { values: Array.from({ length: 7 }, () => (Math.random() * 3 + 25).toFixed(1)) },                kelembaban: { values: Array.from({ length: 7 }, () => (Math.random() * 5 + 75).toFixed(1)) },                debu: { values: Array.from({ length: 7 }, () => (Math.random() * 0.05 + 0.08).toFixed(3)) },                co2: { values: Array.from({ length: 7 }, () => (Math.random() * 300 + 900).toFixed(0)) }            };            document.getElementById('daily-trends-container').innerHTML = SENSORS.map(key => `                <div class="lg:w-1/2 w-full p-4">                    <div class="bg-gray-800 rounded-xl shadow-lg p-4 h-96 border border-gray-700">                        <h3 class="text-lg font-bold text-gray-200 mb-4">${SENSOR_LABELS[key].label} - Tren Harian</h3>                        <canvas id="${key}-daily-chart"></canvas>                    </div>                </div>            `).join('');            SENSORS.forEach(key => {                createChart(                    `${key}-daily-chart`,                     'bar',                     SENSOR_LABELS[key].label,                     { labels: dailyLabels, values: simulatedDailyData[key].values },                    SENSOR_LABELS[key].color                );            });            // ===================================            // 3. MONTHLY TRENDS (Tren Bulanan - 12 Bulan Terakhir)            // ===================================            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'];            const monthlyLabels = monthNames;                         // Data Simulasi            const simulatedMonthlyData = {                suhu: { values: Array.from({ length: 12 }, () => (Math.random() * 2 + 26).toFixed(1)) },                kelembaban: { values: Array.from({ length: 12 }, () => (Math.random() * 10 + 70).toFixed(1)) },                debu: { values: Array.from({ length: 12 }, () => (Math.random() * 0.03 + 0.09).toFixed(3)) },                co2: { values: Array.from({ length: 12 }, () => (Math.random() * 200 + 1000).toFixed(0)) }            };            document.getElementById('monthly-trends-container').innerHTML = SENSORS.map(key => `                <div class="lg:w-1/2 w-full p-4">                    <div class="bg-gray-800 rounded-xl shadow-lg p-4 h-96 border border-gray-700">                        <h3 class="text-lg font-bold text-gray-200 mb-4">${SENSOR_LABELS[key].label} - Tren Bulanan</h3>                        <canvas id="${key}-monthly-chart"></canvas>                    </div>                </div>            `).join('');            SENSORS.forEach(key => {                createChart(                    `${key}-monthly-chart`,                     'bar',                     SENSOR_LABELS[key].label,                     { labels: monthlyLabels, values: simulatedMonthlyData[key].values },                    SENSOR_LABELS[key].color                );            });                        document.getElementById('loading-message').classList.add('hidden');        }        // ==========================================        // 5. INITIALIZATION        // ==========================================        function initApp() {            try {                app = firebase.initializeApp(firebaseConfig);                db = firebase.database();                                listenForCurrentStatus();                fetchAndRenderTrends();                            } catch (error) {                console.error("Firebase initialization failed:", error);                document.getElementById('iaq-status').textContent = "Status: Kesalahan Konfigurasi Firebase.";            }        }        window.onload = initApp;    </script></head><body class="bg-gray-900 min-h-screen text-gray-100">    <div class="container mx-auto p-4 lg:p-8">        <!-- HEADER & STATUS -->        <header class="text-center mb-8">            <h1 class="text-3xl lg:text-4xl font-extrabold text-gray-50 mb-2">IAQ Monitoring Dashboard</h1>            <p class="text-sm text-gray-400">Data Realtime dari Sensor ESP32 IAQ</p>        </header>        <!-- REALTIME STATUS BAR -->        <div id="iaq-status" class="p-4 text-white font-bold rounded-xl shadow-xl text-center mb-4 bg-gray-600">            Memuat Status...        </div>                <!-- LAST UPDATED TIME -->        <div id="last-updated-time" class="mb-8">            <p class="text-sm text-gray-400 text-center mt-2">Memuat waktu pembaruan...</p>        </div>        <!-- SENSOR CARDS -->        <div id="sensor-cards" class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-10">            <!-- Cards akan diisi oleh JavaScript -->        </div>        <!-- TRENDS/GRAPHS SECTION -->        <h2 class="text-2xl font-bold text-gray-100 mb-8 mt-12">Data Trends (Hourly, Daily, Monthly)</h2>        <p id="loading-message" class="text-center text-blue-400 mb-4">Memuat data log dan menghitung tren (simulasi untuk demo)...</p>                <!-- HOURLY TRENDS -->        <h3 class="text-xl font-bold text-gray-300 mb-4 border-b border-gray-700 pb-2">Tren Per Jam (24 Jam Terakhir)</h3>        <div id="hourly-trends-container" class="flex flex-wrap -mx-4 mb-8">            <!-- Grafik Per Jam akan diisi oleh JavaScript -->        </div>        <!-- DAILY TRENDS -->        <h3 class="text-xl font-bold text-gray-300 mb-4 border-b border-gray-700 pb-2">Tren Harian (7 Hari Terakhir)</h3>        <div id="daily-trends-container" class="flex flex-wrap -mx-4 mb-8">            <!-- Grafik Harian akan diisi oleh JavaScript -->        </div>        <!-- MONTHLY TRENDS -->        <h3 class="text-xl font-bold text-gray-300 mb-4 border-b border-gray-700 pb-2">Tren Bulanan (12 Bulan Terakhir)</h3>        <div id="monthly-trends-container" class="flex flex-wrap -mx-4 mb-10">            <!-- Grafik Bulanan akan diisi oleh JavaScript -->        </div>        <div class="mt-8 pt-4 border-t border-gray-700">            <h3 class="text-xl font-bold text-gray-200 mb-2">Catatan Data</h3>            <p class="text-gray-400">Dashboard ini membaca data status real-time dari path `/IAQ/` dan menampilkan tren. Untuk data Tren Per Jam, Harian, dan Bulanan, data yang ditampilkan adalah **simulasi** untuk keperluan demo UI, karena agregasi data log dari Realtime Database dalam browser secara efisien sangat kompleks.</p>        </div>    </div></body></html>