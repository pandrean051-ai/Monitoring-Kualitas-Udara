<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Monitoring Kualitas Udara</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
body { background:#0b0e14; font-family:Inter,sans-serif; color:#d8d9da }
.card { background:#181b1f; border:1px solid #26292e; border-radius:6px }
.nav-active { border-bottom:3px solid #3274d9; color:#3274d9 }
.active-filter { background:#3274d9; color:#fff }
button { cursor:pointer }
</style>
</head>

<body class="p-6">
<div class="max-w-7xl mx-auto">

<!-- HEADER -->
<header class="flex justify-between items-center mb-6 card p-4">
  <h1 class="text-xl font-black text-white">
    MONITORING KUALITAS UDARA
    <span class="block text-xs text-[#3274d9]">Kelompok 11</span>
  </h1>
  <nav class="flex gap-6">
    <button id="btn-dashboard" class="nav-active text-xs font-bold uppercase">Monitor</button>
    <button id="btn-recap" class="text-xs font-bold uppercase text-slate-400">Analitik</button>
  </nav>
</header>

<!-- DASHBOARD -->
<section id="section-dashboard" class="space-y-4">
  <div class="card p-5">
    <p class="text-xs text-slate-400">Kondisi Udara Saat Ini</p>
    <h2 id="status-label" class="text-3xl font-black">MENUNGGU DATA...</h2>
    <p id="last-update" class="text-xs text-slate-500 mt-1"></p>
  </div>
</section>

<!-- ANALITIK -->
<section id="section-recap" class="hidden">
<div class="card p-6">

<!-- FILTER -->
<div class="flex justify-between mb-4">
  <p class="text-xs font-bold uppercase">Grafik Data</p>
  <div class="flex gap-1">
    <button class="f-btn active-filter px-3 py-1 text-xs">Live</button>
    <button class="f-btn px-3 py-1 text-xs">Menit</button>
    <button class="f-btn px-3 py-1 text-xs">Jam</button>
    <button class="f-btn px-3 py-1 text-xs">Hari</button>
  </div>
</div>

<!-- GRAFIK -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
  <div class="card p-4 h-[250px]"><canvas id="chartTemp"></canvas></div>
  <div class="card p-4 h-[250px]"><canvas id="chartHum"></canvas></div>
  <div class="card p-4 h-[250px]"><canvas id="chartCO2"></canvas></div>
  <div class="card p-4 h-[250px]"><canvas id="chartDust"></canvas></div>
</div>

</div>
</section>

</div>

<script>
// ================= FIREBASE =================
firebase.initializeApp({
  apiKey: "AIzaSyAD1QPvINjWitgo_Rrj44s47Pr4S1BU_lM",
  databaseURL: "https://monitoring-kualitas-udar-8ad9d-default-rtdb.asia-southeast1.firebasedatabase.app"
});
const db = firebase.database();

// ================= DATA =================
let logData = [];
let currentFilter = 'sec';

// ================= CHART =================
function createChart(id,color){
  return new Chart(document.getElementById(id),{
    type:'line',
    data:{labels:[],datasets:[{data:[],borderColor:color,backgroundColor:color+'33',fill:true,tension:.3}]},
    options:{
      responsive:true,
      maintainAspectRatio:false,
      plugins:{legend:{display:false}},
      scales:{x:{ticks:{color:'#777'}},y:{ticks:{color:'#777'},beginAtZero:true}}
    }
  });
}

const chartTemp = createChart('chartTemp','#ef4444');
const chartHum  = createChart('chartHum','#3b82f6');
const chartCO2  = createChart('chartCO2','#22c55e');
const chartDust = createChart('chartDust','#facc15');

// ================= RENDER =================
function render(){
  const data = logData.slice(-30);
  const labels = data.map(d=>d.td);

  chartTemp.data.labels = labels;
  chartHum.data.labels  = labels;
  chartCO2.data.labels  = labels;
  chartDust.data.labels = labels;

  chartTemp.data.datasets[0].data = data.map(d=>d.s);
  chartHum.data.datasets[0].data  = data.map(d=>d.h);
  chartCO2.data.datasets[0].data  = data.map(d=>d.c);
  chartDust.data.datasets[0].data = data.map(d=>d.d);

  chartTemp.update();
  chartHum.update();
  chartCO2.update();
  chartDust.update();
}

// ================= FIREBASE LISTENER =================
db.ref('log_sensor').limitToLast(1).on('child_added', snap=>{
  const v = snap.val();
  if(!v) return;

  logData.push({
    td: v.waktu || new Date().toLocaleTimeString(),
    s: Number(v.suhu) || 0,
    h: Number(v.kelembapan) || 0,
    c: Number(v.co2) || 0,
    d: Number(v.debu) || 0
  });

  document.getElementById('status-label').textContent = `COâ‚‚ ${v.co2} ppm`;
  document.getElementById('last-update').textContent =
    `Update ${new Date().toLocaleTimeString()}`;

  render();
});

// ================= NAVIGATION (FIXED) =================
const btnDashboard = document.getElementById('btn-dashboard');
const btnRecap     = document.getElementById('btn-recap');
const secDashboard = document.getElementById('section-dashboard');
const secRecap     = document.getElementById('section-recap');

btnDashboard.onclick = () => {
  secDashboard.classList.remove('hidden');
  secRecap.classList.add('hidden');
  btnDashboard.classList.add('nav-active');
  btnRecap.classList.remove('nav-active');
};

btnRecap.onclick = () => {
  secDashboard.classList.add('hidden');
  secRecap.classList.remove('hidden');
  btnDashboard.classList.remove('nav-active');
  btnRecap.classList.add('nav-active');
};
</script>

</body>
</html>
