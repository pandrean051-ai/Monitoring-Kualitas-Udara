<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Monitoring Kualitas Udara</title>

<!-- LIBRARY -->
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');

body{
  background:#0b0e14;
  font-family:Inter;
  color:#d8d9da;
}

.card{
  background:#181b1f;
  border:1px solid #26292e;
  border-radius:6px;
}

.nav-active{
  border-bottom:3px solid #3274d9;
  color:#3274d9;
}

.active-filter{
  background:#3274d9;
  color:#fff;
}

/* PENTING: HIDDEN BENAR-BENAR MATI */
.hidden{
  display:none !important;
}

/* TABEL */
.table-wrap{
  max-height:320px;
  overflow-y:auto;
  margin-top:12px;
}

table{
  width:100%;
  border-collapse:collapse;
}

thead{
  position:sticky;
  top:0;
  background:#111217;
  z-index:10;
}

th,td{
  padding:6px 8px;
  font-size:11px;
  border-bottom:1px solid #26292e;
}

th{
  color:#9ca3af;
  font-weight:700;
  text-transform:uppercase;
}

tbody tr:nth-child(even){
  background:#14161a;
}

tbody tr:hover{
  background:#1f2937;
}

th:not(:first-child),
td:not(:first-child){
  text-align:center;
}
</style>
</head>

<body class="p-4 lg:p-8">
<div class="max-w-7xl mx-auto">

<!-- HEADER (WAJIB Z-INDEX) -->
<header class="flex justify-between items-center mb-6 card p-4 relative z-50">
  <h1 class="text-xl font-black text-white">
    MONITORING KUALITAS UDARA
    <span class="text-xs text-blue-500">Kelompok 11</span>
  </h1>
  <nav class="flex gap-6">
    <button id="btn-dashboard" onclick="showSection('dashboard')" class="nav-active text-xs font-bold">
      MONITOR
    </button>
    <button id="btn-recap" onclick="showSection('recap')" class="text-xs font-bold text-slate-400">
      ANALITIK
    </button>
  </nav>
</header>

<!-- ================= DASHBOARD ================= -->
<section id="section-dashboard" class="space-y-4">
  <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
    <div class="card p-4"><p class="text-xs text-rose-400">Suhu</p><h3 id="dash-temp" class="text-2xl font-black">-- °C</h3></div>
    <div class="card p-4"><p class="text-xs text-cyan-400">Kelembapan</p><h3 id="dash-hum" class="text-2xl font-black">-- %</h3></div>
    <div class="card p-4"><p class="text-xs text-emerald-400">CO₂</p><h3 id="dash-co2" class="text-2xl font-black">-- ppm</h3></div>
    <div class="card p-4"><p class="text-xs text-amber-400">Debu</p><h3 id="dash-dust" class="text-2xl font-black">-- µg/m³</h3></div>
  </div>

  <div class="card p-4">
    <p class="text-xs text-slate-400 font-bold">Kondisi Udara</p>
    <h2 id="status" class="text-2xl font-black text-slate-500">MENUNGGU DATA</h2>
    <p id="last-update" class="text-[10px] text-slate-600 italic mt-2"></p>
  </div>
</section>

<!-- ================= ANALITIK ================= -->
<section id="section-recap" class="hidden">
<div class="card p-6">

<div class="flex gap-2 mb-4">
  <button class="f-btn active-filter px-3 py-1 text-xs">Live</button>
  <button class="f-btn px-3 py-1 text-xs">Menit</button>
  <button class="f-btn px-3 py-1 text-xs">Jam</button>
  <button class="f-btn px-3 py-1 text-xs">Hari</button>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
  <div class="card p-4 h-[250px]"><p class="text-xs text-rose-500">Suhu</p><canvas id="chartTemp"></canvas></div>
  <div class="card p-4 h-[250px]"><p class="text-xs text-cyan-500">Kelembapan</p><canvas id="chartHum"></canvas></div>
  <div class="card p-4 h-[250px]"><p class="text-xs text-emerald-500">CO₂</p><canvas id="chartCO2"></canvas></div>
  <div class="card p-4 h-[250px]"><p class="text-xs text-amber-500">Debu</p><canvas id="chartDust"></canvas></div>
</div>

<div class="table-wrap">
<table>
<thead>
<tr>
  <th>Waktu</th>
  <th>Suhu</th>
  <th>Hum</th>
  <th>CO₂</th>
  <th>Debu</th>
</tr>
</thead>
<tbody id="table-body"></tbody>
</table>
</div>

</div>
</section>

</div>

<script>
// FIREBASE
firebase.initializeApp({
  apiKey: "AIzaSyAD1QPvINjWitgo_Rrj44s47Pr4S1BU_lM",
  databaseURL: "https://monitoring-kualitas-udar-8ad9d-default-rtdb.asia-southeast1.firebasedatabase.app"
});
const db = firebase.database();

let logData=[];

// CHART
function makeChart(id,color){
  return new Chart(document.getElementById(id),{
    type:'line',
    data:{labels:[],datasets:[{data:[],borderColor:color,tension:.3}]},
    options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}}}
  });
}

const chartTemp=makeChart('chartTemp','#f03e3e');
const chartHum=makeChart('chartHum','#339af0');
const chartCO2=makeChart('chartCO2','#51cf66');
const chartDust=makeChart('chartDust','#fcc419');

// DATA LISTENER
db.ref('log_sensor').limitToLast(1).on('child_added',s=>{
  const v=s.val(); if(!v)return;

  dash-temp.textContent=v.suhu+' °C';
  dash-hum.textContent=v.kelembapan+' %';
  dash-co2.textContent=v.co2+' ppm';
  dash-dust.textContent=v.debu+' µg/m³';
  status.textContent=v.status||'NORMAL';
  last-update.textContent=new Date().toLocaleString('id-ID');

  logData.push({
    t:new Date().toLocaleString('id-ID'),
    s:v.suhu,h:v.kelembapan,c:v.co2,d:v.debu
  });

  chartTemp.data.labels=logData.map(d=>d.t);
  chartTemp.data.datasets[0].data=logData.map(d=>d.s);
  chartTemp.update();

  table-body.innerHTML=logData.slice().reverse().map(d=>`
    <tr>
      <td>${d.t}</td><td>${d.s}</td><td>${d.h}</td><td>${d.c}</td><td>${d.d}</td>
    </tr>`).join('');
});

// NAVIGATION (FIX TOTAL)
function showSection(sec){
  section-dashboard.classList.add('hidden');
  section-recap.classList.add('hidden');
  btn-dashboard.classList.remove('nav-active');
  btn-recap.classList.remove('nav-active');

  if(sec==='dashboard'){
    section-dashboard.classList.remove('hidden');
    btn-dashboard.classList.add('nav-active');
  }else{
    section-recap.classList.remove('hidden');
    btn-recap.classList.add('nav-active');
  }
}
</script>

</body>
</html>
