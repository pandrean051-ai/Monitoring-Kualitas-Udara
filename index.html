<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Monitoring Kualitas Udara</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{background:#0b0e14;color:#d8d9da}
.card{background:#181b1f;border:1px solid #26292e;border-radius:6px}
.nav-active{border-bottom:3px solid #3274d9;color:#3274d9}
.active-filter{background:#3274d9;color:#fff}
</style>
</head>

<body class="p-4">

<div class="max-w-7xl mx-auto">

<!-- HEADER -->
<header class="flex justify-between items-center mb-6 card p-4">
  <h1 class="font-black text-lg text-white">MONITORING KUALITAS UDARA</h1>
  <nav class="flex gap-6 text-xs font-bold uppercase">
    <button id="btn-dashboard" onclick="showSection('dashboard')" class="nav-active">Monitor</button>
    <button id="btn-analitik" onclick="showSection('analitik')">Analitik</button>
  </nav>
</header>

<!-- ================= DASHBOARD ================= -->
<section id="section-dashboard" class="space-y-4">

<div class="grid grid-cols-2 md:grid-cols-4 gap-4">
  <div class="card p-4"><p class="text-xs">Suhu</p><h3 id="dash-temp" class="text-2xl font-black">--</h3></div>
  <div class="card p-4"><p class="text-xs">Kelembapan</p><h3 id="dash-hum" class="text-2xl font-black">--</h3></div>
  <div class="card p-4"><p class="text-xs">CO₂</p><h3 id="dash-co2" class="text-2xl font-black">--</h3></div>
  <div class="card p-4"><p class="text-xs">Debu</p><h3 id="dash-dust" class="text-2xl font-black">--</h3></div>
</div>

<!-- KONDISI UDARA -->
<div class="space-y-3">

<div id="frame-baik" class="card p-4">
  <p class="text-xs font-bold">KONDISI UDARA BAIK</p>
  <h2 id="status-baik" class="text-2xl font-black text-slate-500">TIDAK AKTIF</h2>
  <p class="text-xs text-slate-400">Udara bersih dan aman</p>
</div>

<div id="frame-buruk" class="card p-4">
  <p class="text-xs font-bold">KONDISI UDARA BURUK</p>
  <h2 id="status-buruk" class="text-2xl font-black text-slate-500">TIDAK AKTIF</h2>
  <p class="text-xs text-slate-400">Udara tercemar, kurangi aktivitas</p>
</div>

</div>
</section>

<!-- ================= ANALITIK ================= -->
<section id="section-analitik" style="display:none" class="card p-6">

<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
  <div class="card p-4 h-64"><canvas id="chartTemp"></canvas></div>
  <div class="card p-4 h-64"><canvas id="chartHum"></canvas></div>
  <div class="card p-4 h-64"><canvas id="chartCO2"></canvas></div>
  <div class="card p-4 h-64"><canvas id="chartDust"></canvas></div>
</div>

<div class="overflow-x-auto">
<table class="w-full text-xs border">
<thead>
<tr>
<th class="p-2">Waktu</th>
<th>Suhu</th>
<th>Lembab</th>
<th>CO₂</th>
<th>Debu</th>
</tr>
</thead>
<tbody id="table-body"></tbody>
</table>
</div>

</section>

</div>

<script>
/* ===== ELEMENT ===== */
const dashTemp=document.getElementById('dash-temp');
const dashHum=document.getElementById('dash-hum');
const dashCO2=document.getElementById('dash-co2');
const dashDust=document.getElementById('dash-dust');

const frameBaik=document.getElementById('frame-baik');
const frameBuruk=document.getElementById('frame-buruk');
const statusBaik=document.getElementById('status-baik');
const statusBuruk=document.getElementById('status-buruk');

const sectionDashboard=document.getElementById('section-dashboard');
const sectionAnalitik=document.getElementById('section-analitik');
const btnDashboard=document.getElementById('btn-dashboard');
const btnAnalitik=document.getElementById('btn-analitik');

/* ===== NAV ===== */
function showSection(id){
  sectionDashboard.style.display = id==='dashboard'?'block':'none';
  sectionAnalitik.style.display  = id==='analitik'?'block':'none';
  btnDashboard.classList.toggle('nav-active',id==='dashboard');
  btnAnalitik.classList.toggle('nav-active',id==='analitik');
}

/* ===== FIREBASE ===== */
firebase.initializeApp({
  apiKey:"AIzaSyAD1QPvINjWitgo_Rrj44s47Pr4S1BU_lM",
  databaseURL:"https://monitoring-kualitas-udar-8ad9d-default-rtdb.asia-southeast1.firebasedatabase.app"
});
const db=firebase.database();

/* ===== CHART ===== */
function makeChart(id,color){
  return new Chart(document.getElementById(id),{
    type:'line',
    data:{labels:[],datasets:[{data:[],borderColor:color}]},
    options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}}}
  });
}

const cTemp=makeChart('chartTemp','#f03e3e');
const cHum=makeChart('chartHum','#339af0');
const cCO2=makeChart('chartCO2','#51cf66');
const cDust=makeChart('chartDust','#fcc419');

/* ===== DATA ===== */
let logs=[];

db.ref('log_sensor').limitToLast(1).on('child_added',s=>{
  const v=s.val(); if(!v) return;

  dashTemp.textContent=v.suhu+' °C';
  dashHum.textContent=v.kelembapan+' %';
  dashCO2.textContent=v.co2+' ppm';
  dashDust.textContent=v.debu+' µg/m³';

  // RESET
  frameBaik.className='card p-4';
  frameBuruk.className='card p-4';
  statusBaik.className='text-2xl font-black text-slate-500';
  statusBuruk.className='text-2xl font-black text-slate-500';

  if(v.status==='BAIK'){
    statusBaik.textContent='AKTIF';
    statusBaik.className='text-2xl font-black text-emerald-400';
    frameBaik.classList.add('border-2','border-emerald-400');
  }
  if(v.status==='BURUK'){
    statusBuruk.textContent='AKTIF';
    statusBuruk.className='text-2xl font-black text-rose-500';
    frameBuruk.classList.add('border-2','border-rose-500');
  }

  const t=new Date().toLocaleString('id-ID');
  logs.push({t,...v});
  if(logs.length>50) logs.shift();

  cTemp.data.labels.push(t);
  cTemp.data.datasets[0].data.push(v.suhu);
  cTemp.update();

  document.getElementById('table-body').innerHTML=
    logs.map(l=>`<tr><td>${l.t}</td><td>${l.suhu}</td><td>${l.kelembapan}</td><td>${l.co2}</td><td>${l.debu}</td></tr>`).join('');
});
</script>

</body>
</html>
