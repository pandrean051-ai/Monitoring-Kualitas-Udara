<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Monitoring Kualitas Udara</title>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Firebase v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
body{background:#0b0e14;color:#d8d9da;font-family:Inter,sans-serif}
.card{background:#181b1f;border:1px solid #26292e;border-radius:6px}
.nav-active{border-bottom:3px solid #3274d9;color:#3274d9}
</style>
</head>

<body class="p-4 lg:p-8">
<div class="max-w-7xl mx-auto space-y-6">

<!-- HEADER -->
<header class="flex justify-between items-center card p-4">
  <h1 class="text-xl font-black text-white">
    MONITORING KUALITAS UDARA
    <span class="text-[#3274d9] text-xs">Kelompok 11</span>
  </h1>
</header>

<!-- DASHBOARD -->
<div class="card p-6">
  <p class="text-sm text-slate-400">Kondisi Udara</p>

  <div class="flex items-end gap-2 mt-1">
    <h2 class="text-4xl font-black text-white">
      CO₂ <span id="co2-value">--</span>
    </h2>
    <span class="text-xl text-slate-300 font-bold">ppm</span>
  </div>

  <p id="last-update" class="text-xs text-slate-500 mt-2">
    Update --
  </p>
</div>

<!-- GRAFIK -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">

  <div class="card p-4 h-[260px]">
    <p class="text-xs text-rose-400 mb-2">Suhu (°C)</p>
    <canvas id="chartTemp"></canvas>
  </div>

  <div class="card p-4 h-[260px]">
    <p class="text-xs text-cyan-400 mb-2">Kelembapan (%)</p>
    <canvas id="chartHum"></canvas>
  </div>

  <div class="card p-4 h-[260px]">
    <p class="text-xs text-emerald-400 mb-2">CO₂ (ppm)</p>
    <canvas id="chartCO2"></canvas>
  </div>

  <div class="card p-4 h-[260px]">
    <p class="text-xs text-amber-400 mb-2">Debu (µg/m³)</p>
    <canvas id="chartDust"></canvas>
  </div>

</div>

<!-- TABEL -->
<div class="card overflow-x-auto">
<table class="w-full text-xs">
<thead class="bg-[#111217] text-slate-400">
<tr>
  <th class="p-3">Tanggal</th>
  <th class="p-3">Waktu</th>
  <th class="p-3">Suhu</th>
  <th class="p-3">Kelembapan</th>
  <th class="p-3">CO₂</th>
  <th class="p-3">Debu</th>
</tr>
</thead>
<tbody id="table-body"></tbody>
</table>
</div>

</div>

<script>
/* ================= FIREBASE ================= */
firebase.initializeApp({
  apiKey: "AIzaSyAD1QPvINjWitgo_Rrj44s47Pr4S1BU_lM",
  databaseURL: "https://monitoring-kualitas-udar-8ad9d-default-rtdb.asia-southeast1.firebasedatabase.app"
});
const db = firebase.database();

/* ================= STORAGE ================= */
let logs = [];

/* ================= CHART ================= */
function makeChart(id,color,label){
  return new Chart(document.getElementById(id),{
    type:'line',
    data:{labels:[],datasets:[{
      data:[],
      borderColor:color,
      backgroundColor:color+'33',
      fill:true,
      tension:.3
    }]},
    options:{
      responsive:true,
      maintainAspectRatio:false,
      plugins:{legend:{display:false}},
      scales:{
        x:{ticks:{color:'#888'}},
        y:{ticks:{color:'#888'},beginAtZero:true}
      }
    }
  });
}

const cTemp = makeChart('chartTemp','#f03e3e');
const cHum  = makeChart('chartHum','#339af0');
const cCO2  = makeChart('chartCO2','#51cf66');
const cDust = makeChart('chartDust','#fcc419');

/* ================= RENDER ================= */
function render(){
  const data = logs.slice(-30);

  const labels = data.map(d=>d.waktu);

  cTemp.data.labels = labels;
  cHum.data.labels  = labels;
  cCO2.data.labels  = labels;
  cDust.data.labels = labels;

  cTemp.data.datasets[0].data = data.map(d=>d.suhu);
  cHum.data.datasets[0].data  = data.map(d=>d.kelembapan);
  cCO2.data.datasets[0].data  = data.map(d=>d.co2);
  cDust.data.datasets[0].data = data.map(d=>d.debu);

  cTemp.update();
  cHum.update();
  cCO2.update();
  cDust.update();

  document.getElementById('table-body').innerHTML =
    data.slice().reverse().map(d=>`
      <tr>
        <td class="p-3 text-slate-500">${d.tanggal}</td>
        <td class="p-3 text-slate-500">${d.waktu}</td>
        <td class="p-3 text-rose-400">${d.suhu}</td>
        <td class="p-3 text-cyan-400">${d.kelembapan}</td>
        <td class="p-3 text-emerald-400">${d.co2}</td>
        <td class="p-3 text-amber-400">${d.debu}</td>
      </tr>
    `).join('');
}

/* ================= LISTENER ================= */
db.ref('log_sensor').limitToLast(1).on('child_added', snap=>{
  const v = snap.val();
  if(!v) return;

  logs.push({
    suhu: Number(v.suhu),
    kelembapan: Number(v.kelembapan),
    co2: Number(v.co2),
    debu: Number(v.debu),
    tanggal: v.tanggal,
    waktu: v.waktu
  });

  if(logs.length > 500) logs.shift();

  document.getElementById('co2-value').textContent = v.co2;
  document.getElementById('last-update').textContent =
    `Update ${v.tanggal} ${v.waktu}`;

  render();
});
</script>

</body>
</html>
